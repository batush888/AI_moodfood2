<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoodFood - AI-Powered Food Recommendations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #f1f5f9 100%);
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.02) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* Modern Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(249, 115, 22, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 1rem 0;
        }

        .header-content {
            max-width: 80rem;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            color: inherit;
        }

        .logo-icon {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
        }

        .logo-icon svg {
            width: 1.25rem;
            height: 1.25rem;
            fill: white;
        }

        .logo-text h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }

        .logo-text p {
            font-size: 0.875rem;
            color: #6b7280;
            margin: 0;
        }

        .nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            border-radius: 9999px;
            text-decoration: none;
            color: #6b7280;
            font-weight: 500;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .nav-item:hover {
            color: #f97316;
            background: rgba(249, 115, 22, 0.05);
            transform: translateY(-1px);
        }

        .nav-item.active {
            background: #fed7aa;
            color: #ea580c;
            border-color: #f97316;
        }

        .nav-item svg {
            width: 1.125rem;
            height: 1.125rem;
        }

        /* Main Content */
        .main {
            max-width: 80rem;
            margin: 0 auto;
            padding: 2rem;
            padding-left: 320px; /* Make room for left sidebar */
            position: relative;
            z-index: 1;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            margin-bottom: 3rem;
        }

        .hero h2 {
            font-size: 3.5rem;
            font-weight: 800;
            color: #1f2937;
            margin-bottom: 1.5rem;
            line-height: 1.1;
        }

        .hero .highlight {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.25rem;
            color: #6b7280;
            max-width: 40rem;
            margin: 0 auto 2rem;
        }

        /* Modern Search Container */
        .search-container {
            max-width: 56rem;
            margin: 0 auto 3rem;
            position: relative;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(15px);
            border-radius: 2rem;
            box-shadow: 
                0 16px 32px rgba(0, 0, 0, 0.08),
                0 8px 16px rgba(0, 0, 0, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.4);
            padding: 2rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 15;
        }

        .search-container:hover {
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.12),
                0 10px 20px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }

        .search-form {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 1.5rem 4rem 1.5rem 4rem;
            font-size: 1.125rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border: 2px solid #fed7aa;
            border-radius: 1.5rem;
            box-shadow: 0 8px 32px -8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #f97316;
            box-shadow: 0 0 0 4px rgba(249, 115, 22, 0.1), 0 8px 32px -8px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .search-icon {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            color: #f97316;
        }

        .search-icon svg {
            width: 1.25rem;
            height: 1.25rem;
        }

        .search-button {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            color: white;
            border: none;
            border-radius: 0.75rem;
            padding: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
        }

        .search-button:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 6px 16px rgba(249, 115, 22, 0.4);
        }

        .search-button:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: translateY(-50%);
            box-shadow: none;
        }

        .search-button svg {
            width: 1.125rem;
            height: 1.125rem;
        }

        /* Enhanced Suggestions Dropdown */
        .suggestions-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 0.75rem;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(16px);
            border-radius: 1.5rem;
            box-shadow: 0 12px 40px -8px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(249, 115, 22, 0.1);
            padding: 1.5rem;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .suggestions-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .suggestions-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 1rem;
        }

        .suggestions-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .suggestion-chip {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 1rem;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .suggestion-chip:hover {
            background: #fef3c7;
            border-color: #f97316;
            color: #92400e;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.15);
        }

        /* Context Controls Grid - Positioned on the left side */
        .context-controls {
            position: fixed;
            left: 2rem;
            top: 50%;
            transform: translateY(-50%);
            width: 280px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Responsive design for smaller screens */
        @media (max-width: 1200px) {
            .context-controls {
                position: static;
                transform: none;
                width: 100%;
                margin-bottom: 2rem;
                display: grid;
                grid-template-columns: repeat(3, 1fr);
            }
            
            .main {
                padding-left: 2rem;
            }
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            width: 100%;
            min-height: 6rem;
        }

        .control-label {
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-label svg {
            width: 1rem;
            height: 1rem;
            color: #f97316;
        }

        .control-input {
            padding: 0.875rem;
            border: 1px solid #d1d5db;
            border-radius: 0.75rem;
            background: white;
            transition: all 0.2s;
            font-size: 0.875rem;
            height: 3rem;
            box-sizing: border-box;
        }

        .control-input:focus {
            outline: none;
            border-color: #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
        }

        .time-display {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem;
            background: #fef3c7;
            border: 1px solid #fed7aa;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            color: #92400e;
            height: 3rem;
            box-sizing: border-box;
        }

        .time-display svg {
            width: 1rem;
            height: 1rem;
        }

        .time-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .time-button {
            padding: 0.25rem 0.5rem;
            background: white;
            border: 1px solid #fed7aa;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .time-button:hover {
            background: #f97316;
            color: white;
            border-color: #f97316;
        }

        .weather-display {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem;
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            color: #1e40af;
            height: 3rem;
            box-sizing: border-box;
        }

        .weather-display svg {
            width: 1rem;
            height: 1rem;
        }

        /* Results Section */
        .results-section {
            margin-top: 3rem;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 2rem;
            padding: 2rem;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.1),
                0 8px 16px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.4);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 5;
        }

        .results-section:hover {
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.15),
                0 12px 24px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.95);
            transform: translateY(-2px);
        }

        .results-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 1.5rem;
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
        }

        .results-count {
            font-size: 0.875rem;
            color: #6b7280;
        }

        /* AI Analysis Section */
        .ai-analysis {
            background: rgba(254, 243, 199, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(249, 115, 22, 0.3);
            border-radius: 1.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 
                0 8px 32px rgba(249, 115, 22, 0.15),
                0 4px 16px rgba(249, 115, 22, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
            position: relative;
            z-index: 10;
        }

        .ai-analysis:hover {
            box-shadow: 
                0 12px 40px rgba(249, 115, 22, 0.2),
                0 6px 20px rgba(249, 115, 22, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }

        .ai-analysis h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #92400e;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .ai-analysis h3 svg {
            width: 1.25rem;
            height: 1.25rem;
        }

        .ai-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .ai-detail {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            padding: 1rem;
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }

        .ai-detail:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.12),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }

        .ai-detail-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }

        .ai-detail-value {
            font-size: 0.875rem;
            font-weight: 500;
            color: #1f2937;
        }

        /* Recommendations Grid */
        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 2rem;
            position: relative;
            z-index: 5;
        }

        .recommendation-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                0 2px 8px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
        }

        .recommendation-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.15),
                0 8px 16px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }

        .recommendation-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .recommendation-card:hover::before {
            opacity: 1;
        }

        /* Animation for cards appearing */
        .recommendation-card {
            animation: cardAppear 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        .recommendation-card:nth-child(1) { animation-delay: 0.1s; }
        .recommendation-card:nth-child(2) { animation-delay: 0.2s; }
        .recommendation-card:nth-child(3) { animation-delay: 0.3s; }
        .recommendation-card:nth-child(4) { animation-delay: 0.4s; }
        .recommendation-card:nth-child(5) { animation-delay: 0.5s; }

        @keyframes cardAppear {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .recommendation-content {
            padding: 1.5rem;
        }

        .recommendation-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .recommendation-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
            line-height: 1.3;
        }

        .recommendation-score {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
        }

        .recommendation-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .detail-item {
            text-align: center;
            padding: 0.75rem;
            background: rgba(249, 250, 251, 0.8);
            border-radius: 0.75rem;
            border: 1px solid rgba(229, 231, 235, 0.5);
        }

        .detail-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }

        .detail-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: #1f2937;
        }

        .feedback-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid rgba(229, 231, 235, 0.3);
        }

        .feedback-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .feedback-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(229, 231, 235, 0.5);
            border-radius: 0.75rem;
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
        }

        .feedback-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .feedback-btn.thumbs-up {
            border-color: rgba(34, 197, 94, 0.3);
            color: #059669;
        }

        .feedback-btn.thumbs-up:hover {
            background: rgba(34, 197, 94, 0.1);
            border-color: rgba(34, 197, 94, 0.5);
        }

        .feedback-btn.thumbs-down {
            border-color: rgba(239, 68, 68, 0.3);
            color: #dc2626;
        }

        .feedback-btn.thumbs-down:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.5);
        }

        .feedback-btn.active {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.5);
            color: #2563eb;
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
        }

        .feedback-btn:active {
            transform: scale(0.95);
            transition: transform 0.1s ease;
        }

        .feedback-btn.thumbs-up.active {
            background: rgba(34, 197, 94, 0.15);
            border-color: rgba(34, 197, 94, 0.6);
            color: #047857;
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.3);
        }

        .feedback-btn.thumbs-down.active {
            background: rgba(239, 68, 68, 0.15);
            border-color: rgba(239, 68, 68, 0.6);
            color: #b91c1c;
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.3);
        }

        .feedback-btn svg {
            width: 1rem;
            height: 1rem;
            transition: transform 0.2s ease;
        }

        .feedback-btn:hover svg {
            transform: scale(1.1);
        }

        .feedback-btn.thumbs-up:hover svg {
            transform: scale(1.1) rotate(-5deg);
        }

        .feedback-btn.thumbs-down:hover svg {
            transform: scale(1.1) rotate(5deg);
        }

        /* Loading state for feedback submission */
        .feedback-btn.loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .feedback-btn.loading svg {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .feedback-status {
            font-size: 0.75rem;
            color: #6b7280;
            font-style: italic;
        }

        .reasoning-section {
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(249, 250, 251, 0.6);
            border-radius: 0.75rem;
            border: 1px solid rgba(229, 231, 235, 0.3);
        }

        .reasoning-title {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .reasoning-text {
            color: #4b5563;
            line-height: 1.5;
            font-size: 0.875rem;
        }

        .reasoning-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .reasoning-item {
            color: #4b5563;
            line-height: 1.5;
            font-size: 0.875rem;
            padding: 0.25rem 0;
            border-left: 2px solid rgba(59, 130, 246, 0.3);
            padding-left: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .tag {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid #f3f4f6;
        }

        .food-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .food-category {
            display: inline-block;
            background: #fef3c7;
            color: #92400e;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .card-content {
            padding: 1.5rem;
        }

        .food-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .detail-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .detail-value {
            font-size: 0.875rem;
            color: #1f2937;
            font-weight: 500;
        }

        .food-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .food-tag {
            background: #f3f4f6;
            color: #374151;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .score-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
        }

        .score-item {
            text-align: center;
        }

        .score-value {
            font-size: 1.125rem;
            font-weight: 700;
            color: #f97316;
        }

        .score-label {
            font-size: 0.75rem;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .reasoning-section {
            background: #fef3c7;
            border: 1px solid #fed7aa;
            border-radius: 0.75rem;
            padding: 1rem;
        }

        .reasoning-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #92400e;
            margin-bottom: 0.5rem;
        }

        .reasoning-list {
            list-style: none;
            padding: 0;
        }

        .reasoning-item {
            font-size: 0.875rem;
            color: #92400e;
            margin-bottom: 0.25rem;
            padding-left: 1rem;
            position: relative;
        }

        .reasoning-item::before {
            content: "â€¢";
            position: absolute;
            left: 0;
            color: #f97316;
            font-weight: bold;
        }

        /* Debug Toggle */
        .debug-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 1000;
            transition: all 0.2s;
        }

        .debug-toggle:hover {
            background: rgba(0, 0, 0, 0.9);
        }

        .debug-toggle.active {
            background: #f97316;
        }

        .debug-toggle svg {
            width: 1rem;
            height: 1rem;
        }

        /* Debug Section */
        .debug-section {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .debug-section h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 1rem;
        }

        .debug-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .debug-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .debug-item h4 {
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }

        .debug-item pre {
            background: #f1f5f9;
            padding: 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            color: #475569;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-word;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 3rem;
        }

        .loading-spinner {
            width: 3rem;
            height: 3rem;
            border: 3px solid #f3f4f6;
            border-top: 3px solid #f97316;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.125rem;
            color: #6b7280;
        }

        /* Error Section */
        .error-section {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .error-content h3 {
            color: #dc2626;
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .error-content p {
            color: #7f1d1d;
            font-size: 0.875rem;
        }

        /* Feedback Section */
        .feedback-section {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .feedback-section h3 {
            color: #0369a1;
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .feedback-content {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .rating-section {
            text-align: center;
        }

        .stars {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
        }

        .star {
            font-size: 1.5rem;
            color: #d1d5db;
            cursor: pointer;
            transition: color 0.2s;
        }

        .star:hover,
        .star.active {
            color: #fbbf24;
        }

        .feedback-input {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .feedback-input textarea {
            width: 100%;
            min-height: 100px;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            resize: vertical;
            font-family: inherit;
        }

        .feedback-input button {
            align-self: flex-end;
            background: #0369a1;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }

        .feedback-input button:hover {
            background: #075985;
        }

        /* Custom Dropdown Styles */
        .custom-dropdown {
            position: relative;
            width: 100%;
        }

        .dropdown-trigger {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.875rem;
            color: #1f2937;
            height: 3rem;
            box-sizing: border-box;
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
        }

        .dropdown-trigger:hover {
            border-color: rgba(249, 115, 22, 0.5);
            box-shadow: 
                0 8px 24px rgba(0, 0, 0, 0.12),
                0 0 0 3px rgba(249, 115, 22, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }

        .dropdown-trigger:focus {
            outline: none;
            border-color: rgba(249, 115, 22, 0.6);
            box-shadow: 
                0 8px 24px rgba(0, 0, 0, 0.12),
                0 0 0 3px rgba(249, 115, 22, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            transform: translateY(-1px);
        }

        .dropdown-value {
            font-weight: 500;
        }

        .dropdown-arrow {
            width: 1rem;
            height: 1rem;
            color: #6b7280;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dropdown-trigger:hover .dropdown-arrow {
            color: #f97316;
            transform: scale(1.1);
        }

        .custom-dropdown.open .dropdown-arrow {
            transform: rotate(180deg);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 0.5rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 1rem;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.15),
                0 8px 16px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            overflow: hidden;
        }

        .custom-dropdown.open .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            animation: dropdownAppear 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes dropdownAppear {
            from {
                opacity: 0;
                transform: translateY(-10px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Backdrop effect for dropdown */
        .custom-dropdown.open::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(2px);
            z-index: 999;
            pointer-events: none;
        }

        .dropdown-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.875rem;
            color: #1f2937;
            position: relative;
            border-bottom: 1px solid rgba(229, 231, 235, 0.3);
        }

        .dropdown-option:last-child {
            border-bottom: none;
        }

        .dropdown-option:hover {
            background: rgba(249, 115, 22, 0.08);
            transform: translateX(4px);
        }

        .dropdown-option:active {
            transform: translateX(2px) scale(0.98);
        }

        .dropdown-option:first-child {
            border-radius: 0.75rem 0.75rem 0 0;
        }

        .dropdown-option:last-child {
            border-radius: 0 0 0.75rem 0.75rem;
        }

        .energy-indicator {
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .energy-indicator.low {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 
                0 4px 12px rgba(239, 68, 68, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .energy-indicator.medium {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 
                0 4px 12px rgba(245, 158, 11, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .energy-indicator.high {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 
                0 4px 12px rgba(16, 185, 129, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        /* Energy indicator animations */
        .energy-indicator {
            position: relative;
            overflow: hidden;
        }

        .energy-indicator::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .dropdown-option:hover .energy-indicator::before {
            left: 100%;
        }

        /* Keyboard navigation support */
        .dropdown-option:focus {
            outline: none;
            background: rgba(249, 115, 22, 0.1);
        }

        /* Smooth transitions for all interactive elements */
        .dropdown-trigger * {
            transition: all 0.2s ease;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .context-controls {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.25rem;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                padding: 0 1rem;
            }

            .main {
                padding: 1rem;
            }

            .hero h2 {
                font-size: 2.5rem;
            }

            .search-input {
                padding: 1.25rem 3.5rem 1.25rem 3.5rem;
                font-size: 1rem;
            }

            .context-controls {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .control-group {
                min-height: auto;
            }

            .dropdown-menu {
                position: fixed;
                top: auto;
                left: 1rem;
                right: 1rem;
                margin-top: 0.25rem;
            }

            .recommendations-grid {
                grid-template-columns: 1fr;
            }

            .food-details {
                grid-template-columns: 1fr;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mt-4 {
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="#" class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                </div>
                <div class="logo-text">
                    <h1>MoodFood</h1>
                    <p>AI-Powered Food Recommendations</p>
                </div>
            </a>
            <nav class="nav">
                <a href="#" class="nav-item active">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    Search
                </a>
                <a href="#" class="nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                    Favorites
                </a>
                <a href="#" class="nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    Profile
                </a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Hero Section -->
        <section class="hero">
            <h2>Find Your Perfect <span class="highlight">Mood Food</span></h2>
            <p>Tell us how you're feeling and we'll recommend the perfect food to match your mood, preferences, and context.</p>
        </section>

        <!-- Search Container -->
        <section class="search-container">
            <form class="search-form" id="searchForm">
                <div class="search-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </div>
                <input 
                    type="text" 
                    class="search-input" 
                    id="textInput" 
                    placeholder="What are you craving today?"
                    autocomplete="off"
                >
                <button type="submit" class="search-button" id="searchButton">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                    </svg>
                </button>
            </form>

            <!-- Suggestions Dropdown -->
            <div class="suggestions-dropdown" id="suggestionsDropdown">
                <div class="suggestions-title">Try these suggestions:</div>
                <div class="suggestions-grid">
                    <div class="suggestion-chip">I want something light and healthy</div>
                    <div class="suggestion-chip">Craving spicy and bold flavors</div>
                    <div class="suggestion-chip">Need some warm comfort food</div>
                    <div class="suggestion-chip">Looking for a romantic dinner with my partner</div>
                    <div class="suggestion-chip">Something quick for lunch with colleagues</div>
                    <div class="suggestion-chip">I feel like celebrating with friends!</div>
                    <div class="suggestion-chip">Family dinner ideas for tonight</div>
                    <div class="suggestion-chip">Comfort food for when I'm alone</div>
                    <div class="suggestion-chip">Date night restaurant suggestions</div>
                    <div class="suggestion-chip">Work lunch with the team</div>
                    <div class="suggestion-chip">Dinner with my parents</div>
                </div>
            </div>
        </section>

        <!-- Context Controls -->
        <section class="context-controls">
            <div class="control-group">
                <label class="control-label">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12,6 12,12 16,14"/>
                    </svg>
                    Time of Day
                </label>
                <div class="time-display" id="timeDisplay">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12,6 12,12 16,14"/>
                    </svg>
                    <span id="timeText">Detecting...</span>
                    <div class="time-buttons">
                        <button class="time-button" onclick="refreshTime()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                                <path d="M21 3v5h-5"/>
                                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                                <path d="M3 21v-5h5"/>
                            </svg>
                        </button>
                        <button class="time-button" onclick="toggleTimeFormat()">12/24</button>
                    </div>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 6.34L4.93 4.93M19.07 19.07l-1.41-1.41"/>
                    </svg>
                    Weather
                </label>
                <div class="weather-display" id="weatherDisplay">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 6.34L4.93 4.93M19.07 19.07l-1.41-1.41"/>
                    </svg>
                    <span id="weatherText">Detecting...</span>
                    <button class="time-button" onclick="getCurrentWeather()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                            <path d="M21 3v5h-5"/>
                            <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                            <path d="M3 21v-5h5"/>
                        </svg>
                    </button>
                </div>
            </div>



            <div class="control-group">
                <label class="control-label">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                    </svg>
                    Energy Level
                </label>
                <div class="custom-dropdown" id="energyDropdown">
                    <div class="dropdown-trigger" onclick="toggleEnergyDropdown()" tabindex="0" role="button" aria-haspopup="true" aria-expanded="false">
                        <span class="dropdown-value" id="energyValue">Medium Energy</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </div>
                    <div class="dropdown-menu" id="energyMenu">
                        <div class="dropdown-option" data-value="low" onclick="selectEnergyLevel('low', 'Low Energy')">
                            <div class="energy-indicator low"></div>
                            <span>Low Energy</span>
                        </div>
                        <div class="dropdown-option" data-value="medium" onclick="selectEnergyLevel('medium', 'Medium Energy')">
                            <div class="energy-indicator medium"></div>
                            <span>Medium Energy</span>
                        </div>
                        <div class="dropdown-option" data-value="high" onclick="selectEnergyLevel('high', 'High Energy')">
                            <div class="energy-indicator high"></div>
                            <span>High Energy</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Debug Toggle -->
        <div class="debug-toggle" onclick="toggleDebug()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12l2 2 4-4"/>
                <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"/>
            </svg>
            Debug
        </div>
        
        <!-- Weather Test Button -->
        <button onclick="testWeatherSystem()" style="position: fixed; top: 10px; right: 10px; z-index: 1000; padding: 8px 12px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Test Weather
        </button>

        <!-- Debug Section -->
        <section class="debug-section hidden" id="debugSection">
            <h3>Debug Information</h3>
            <div class="debug-content">
                <div class="debug-item">
                    <h4>API Base</h4>
                    <pre id="debugApiBase"></pre>
                </div>
                <div class="debug-item">
                    <h4>Request Payload</h4>
                    <pre id="debugRequest"></pre>
                </div>
                <div class="debug-item">
                    <h4>Response</h4>
                    <pre id="debugResponse"></pre>
                </div>
                <div class="debug-item">
                    <h4>Performance</h4>
                    <pre id="debugPerformance"></pre>
                </div>
            </div>
        </section>

        <!-- AI Analysis Section -->
        <section class="ai-analysis" id="aiAnalysis">
            <h3>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                </svg>
                AI Analysis
            </h3>
            <div class="ai-details" id="aiDetails">
                <!-- AI analysis details will be populated here -->
            </div>
        </section>

        <!-- Results Section -->
        <section class="results-section" id="resultsSection" style="display: none;">
            <div class="results-header">
                <h2 class="results-title">Recommended for You</h2>
                <span class="results-count" id="resultsCount">0 recommendations</span>
            </div>
            <div class="recommendations-grid" id="recommendationsGrid">
                <!-- Recommendations will be populated here -->
            </div>
        </section>

        <!-- Loading State -->
        <section class="loading hidden" id="loadingSection">
            <div class="loading-spinner"></div>
            <p class="loading-text">Finding perfect matches for your mood...</p>
        </section>

        <!-- Error Section -->
        <section class="error-section hidden" id="errorSection">
            <div class="error-content">
                <h3>Error</h3>
                <p id="errorMessage"></p>
            </div>
        </section>

        <!-- Feedback Section -->
        <section class="feedback-section hidden" id="feedbackSection">
            <h3>How was your experience?</h3>
            <div class="feedback-content">
                <div class="rating-section">
                    <div class="stars">
                        <span class="star" data-rating="1">â˜…</span>
                        <span class="star" data-rating="2">â˜…</span>
                        <span class="star" data-rating="3">â˜…</span>
                        <span class="star" data-rating="4">â˜…</span>
                        <span class="star" data-rating="5">â˜…</span>
                    </div>
                </div>
                <div class="feedback-input">
                    <textarea id="feedbackText" placeholder="Tell us more about your experience..."></textarea>
                    <button onclick="submitFeedback()">Submit Feedback</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Load configuration first -->
            <script src="/static/config.js"></script>
    
    <script>
        // Configuration
        const API_BASE = window.CONFIG ? window.CONFIG.API_BASE : 'http://localhost:8000';
        let currentRecommendations = null;
        let currentRating = 0;
        let hasSearched = false;

        // Time system variables
        let _timeInterval = null;
        let _use24Hour = false;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeTimeSystem();
            initializeWeatherSystem();
            setupEventListeners();
            loadUserPreferences();
        });

        // Time system functions
        function initializeTimeSystem() {
            initializeTimeDetection();
            setupTimeRefresh();
        }

        function initializeTimeDetection() {
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', updateTimeDisplay);
            } else {
                updateTimeDisplay();
            }
            
            // Update time every minute
            _timeInterval = setInterval(updateTimeDisplay, 60000);
        }

        function updateTimeDisplay() {
            if (document.readyState !== 'complete') return;
            
            const now = new Date();
            const currentTimeElement = document.getElementById('timeText');
            
            if (!currentTimeElement) return;
            
            // Format current time based on user preference
            const timeString = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: !_use24Hour
            });
            currentTimeElement.textContent = timeString;
            
            // Determine time category
            const hour = now.getHours();
            let timeCategory, timeValue;
            
            if (hour >= 5 && hour < 12) {
                timeCategory = 'Morning';
                timeValue = 'morning';
            } else if (hour >= 12 && hour < 17) {
                timeCategory = 'Afternoon';
                timeValue = 'afternoon';
            } else if (hour >= 17 && hour < 21) {
                timeCategory = 'Evening';
                timeValue = 'evening';
            } else {
                timeCategory = 'Night';
                timeValue = 'night';
            }
            
            // The timeCategory and timeValue are now handled by the time-display div
        }

        function setupTimeRefresh() {
            const refreshBtn = document.querySelector('.time-button');
            
            if (!refreshBtn) return;
            
            refreshBtn.addEventListener('click', function() {
                updateTimeDisplay();
            });
        }

        function loadUserPreferences() {
            const savedFormat = localStorage.getItem('timeFormat24Hour');
            if (savedFormat !== null) {
                _use24Hour = savedFormat === 'true';
            }
        }

        function saveUserPreferences() {
            localStorage.setItem('timeFormat24Hour', _use24Hour.toString());
        }

                        // Weather system functions - using secure proxy endpoints
                let currentWeather = 'unknown';
        let userLocation = null;

        async function getCurrentWeather() {
            try {
                const weatherTextElement = document.getElementById("weatherText");
                const manualWeather = weatherTextElement?.textContent?.trim();
                
                // Only use manual weather if it's not the default "Detecting..." text
                if (manualWeather && manualWeather !== "Detecting..." && manualWeather !== "unknown") {
                    console.log('Using manual weather:', manualWeather);
                    currentWeather = manualWeather;
                    updateWeatherDisplayManual(manualWeather);
                    return manualWeather;
                }
                
                if (!userLocation) {
                    userLocation = await getUserLocation();
                }
                
                if (!userLocation) {
                    throw new Error('Unable to get user location');
                }
                
                try {
                    console.log('Fetching weather for location:', userLocation);
                    const weatherData = await fetchGaodeWeatherWithGeocoding(userLocation.latitude, userLocation.longitude);
                    
                    if (!weatherData) {
                        throw new Error('No weather data received from Gaode API');
                    }
                    
                    console.log('Weather data received:', weatherData);
                    const weatherCategory = categorizeGaodeWeather(weatherData);
                    console.log('Weather category:', weatherCategory);
                    updateWeatherDisplay(weatherData, weatherCategory);
                    document.getElementById('weatherText').textContent = `${weatherCategory} ${weatherData.temperature}Â°C`;
                    currentWeather = weatherCategory;
                    return weatherCategory;
                    
                } catch (apiError) {
                    console.log('Gaode API failed, trying fallback methods:', apiError);
                    try {
                        const timeOfDay = getTimeOfDay();
                        console.log('Trying feedback weather for time of day:', timeOfDay);
                        const feedbackWeather = await fetchRecentFeedbackWeather(timeOfDay);
                        
                        if (feedbackWeather && feedbackWeather !== 'unknown') {
                            console.log('Using feedback weather:', feedbackWeather);
                            currentWeather = feedbackWeather;
                            updateWeatherDisplayManual(feedbackWeather);
                            document.getElementById('weatherText').textContent = `${feedbackWeather} (auto)`;
                            return feedbackWeather;
                        }
                    } catch (feedbackError) {
                        console.log('Feedback fallback failed:', feedbackError);
                    }
                    
                    const seasonalWeather = getSeasonalDefaultWeather();
                    console.log('Using seasonal weather:', seasonalWeather);
                    currentWeather = seasonalWeather;
                    updateWeatherDisplayManual(seasonalWeather);
                    document.getElementById('weatherText').textContent = `${seasonalWeather} (auto)`;
                    return seasonalWeather;
                }
                
            } catch (error) {
                console.error('All weather methods failed:', error);
                const fallbackWeather = getSeasonalDefaultWeather();
                console.log('Using final fallback weather:', fallbackWeather);
                currentWeather = fallbackWeather;
                updateWeatherDisplayManual(fallbackWeather);
                document.getElementById('weatherText').textContent = `${fallbackWeather} (auto)`;
                return fallbackWeather;
            }
        }

        function getUserLocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    resolve({ latitude: 37.7749, longitude: -122.4194 });
                    return;
                }
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const location = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        };
                        resolve(location);
                    },
                    (error) => {
                        resolve({ latitude: 37.7749, longitude: -122.4194 });
                    },
                    { timeout: 5000, enableHighAccuracy: false }
                );
            });
        }

        function getTimeOfDay() {
            const hour = new Date().getHours();
            if (hour >= 5 && hour < 12) return 'morning';
            if (hour >= 12 && hour < 17) return 'afternoon';
            if (hour >= 17 && hour < 21) return 'evening';
            return 'night';
        }

        function getSeasonalDefaultWeather() {
            const month = new Date().getMonth();
            if (month >= 6 && month <= 8) return "hot";
            if (month >= 9 && month <= 11) return "mild";
            if (month >= 12 || month <= 2) return "cold";
            return "mild";
        }

        async function fetchRecentFeedbackWeather(timeOfDay) {
            try {
                const response = await fetch('http://localhost:8000/recent-feedback-weather', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ 
                        user_id: "user123", 
                        time_of_day: timeOfDay 
                    }),
                    signal: AbortSignal.timeout(5000)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.weather && data.weather !== 'unknown') {
                        return data.weather;
                    }
                }
                
                return 'unknown';
                
            } catch (error) {
                return 'unknown';
            }
        }

        async function fetchGaodeWeatherWithGeocoding(lat, lng) {
            try {
                console.log('Making secure proxy API call for coordinates:', lat, lng);
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);
                
                // Use secure proxy endpoint for geocoding
                const geoUrl = `${API_BASE}/api/geocode?location=${lng},${lat}`;
                console.log('Secure geocoding URL:', geoUrl);
                
                const geoResponse = await fetch(geoUrl, {
                    signal: controller.signal,
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                clearTimeout(timeoutId);
                
                if (!geoResponse.ok) {
                    throw new Error(`Secure geocoding API error: ${geoResponse.status}`);
                }
                
                const geoData = await geoResponse.json();
                console.log('Geocoding response:', geoData);
                
                if (geoData.status !== '1' || !geoData.regeocode || !geoData.regeocode.adcode) {
                    throw new Error('Invalid geocode response');
                }
                
                const adcode = geoData.regeocode.adcode;
                console.log('Adcode:', adcode);
                
                // Use secure proxy endpoint for weather
                const weatherUrl = `${API_BASE}/api/weather?city=${adcode}&extensions=base`;
                console.log('Secure weather API URL:', weatherUrl);
                
                const weatherResponse = await fetch(weatherUrl, {
                    signal: controller.signal,
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!weatherResponse.ok) {
                    throw new Error(`Secure weather API error: ${weatherResponse.status}`);
                }
                
                const weatherData = await weatherResponse.json();
                console.log('Weather API response:', weatherData);
                
                if (weatherData.status === '1' && weatherData.lives && weatherData.lives.length > 0) {
                    console.log('Weather data extracted:', weatherData.lives[0]);
                    return weatherData.lives[0];
                } else {
                    throw new Error(`Weather API error: ${weatherData.info || 'Unknown error'}`);
                }
                
            } catch (error) {
                if (error.name === 'AbortError') {
                    throw new Error('Secure API request timed out');
                }
                throw error;
            }
        }

        function categorizeGaodeWeather(weatherData) {
            const temperature = parseFloat(weatherData.temperature);
            const weatherCondition = weatherData.weather;
            
            const weatherMap = {
                "æ™´": "sunny",
                "å¤šäº‘": "cloudy",
                "é˜´": "cloudy",
                "é›¨": "rainy",
                "å°é›¨": "rainy",
                "ä¸­é›¨": "rainy",
                "å¤§é›¨": "rainy",
                "é›ª": "snowy",
                "å°é›ª": "snowy",
                "ä¸­é›ª": "snowy",
                "å¤§é›ª": "snowy",
                "é›¾": "foggy",
                "éœ¾": "hazy"
            };
            
            const mappedCondition = weatherMap[weatherCondition] || "unknown";
            
            if (temperature > 25) return "hot";
            if (temperature < 10) return "cold";
            if (temperature >= 10 && temperature <= 25) return "warm";
            
            return mappedCondition !== "unknown" ? mappedCondition : "moderate";
        }

        function updateWeatherDisplayManual(weatherCategory) {
            const weatherDisplay = document.getElementById('weatherDisplay');
            const weatherText = document.getElementById('weatherText');
            
            if (!weatherDisplay || !weatherText) return;
            
            // Update the SVG icon based on weather
            const svgIcon = weatherDisplay.querySelector('svg');
            if (svgIcon) {
                const iconMap = {
                    'hot': `<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>`,
                    'cold': `<path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>`,
                    'warm': `<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>`,
                    'rainy': `<path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path><path d="M8 21l4-7 4 7"></path>`,
                    'cloudy': `<path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>`,
                    'sunny': `<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>`,
                    'snowy': `<path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>`,
                    'foggy': `<path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>`,
                    'hazy': `<path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>`,
                    'mild': `<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>`,
                    'moderate': `<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>`
                };
                
                svgIcon.innerHTML = iconMap[weatherCategory] || iconMap['mild'];
            }
            
            weatherText.textContent = weatherCategory.charAt(0).toUpperCase() + weatherCategory.slice(1);
        }

        function updateWeatherDisplay(weatherData, weatherCategory) {
            const weatherDisplay = document.getElementById('weatherDisplay');
            const weatherText = document.getElementById('weatherText');
            
            // Update the SVG icon based on weather
            const svgIcon = weatherDisplay.querySelector('svg');
            if (svgIcon) {
                const iconMap = {
                    'hot': `<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>`,
                    'cold': `<path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>`,
                    'warm': `<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>`,
                    'rainy': `<path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path><path d="M8 21l4-7 4 7"></path>`,
                    'cloudy': `<path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>`,
                    'sunny': `<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>`,
                    'moderate': `<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>`
                };
                
                svgIcon.innerHTML = iconMap[weatherCategory] || iconMap['moderate'];
            }
            
            const temp = weatherData.temperature;
            const condition = weatherData.weather;
            weatherText.textContent = `${condition} ${temp}Â°C`;
        }

        function setupWeatherRefresh() {
            const refreshBtn = document.querySelector('#weatherDisplay .time-button');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    getCurrentWeather();
                });
            }
        }

        function initializeWeatherSystem() {
            console.log('Initializing weather system...');
            setupWeatherRefresh();
            getCurrentWeather();
        }

        // Test function for debugging weather
        async function testWeatherSystem() {
            console.log('=== Testing Weather System ===');
            console.log('Current weather element:', document.getElementById('weatherText'));
            console.log('Current weather text:', document.getElementById('weatherText')?.textContent);
            
            try {
                const location = await getUserLocation();
                console.log('User location:', location);
                
                const weather = await getCurrentWeather();
                console.log('Final weather result:', weather);
            } catch (error) {
                console.error('Weather test failed:', error);
            }
        }

        // Event listeners
        function setupEventListeners() {
            document.getElementById('searchForm').addEventListener('submit', getEnhancedRecommendations);
            
            // Suggestions dropdown
            const textInput = document.getElementById('textInput');
            const suggestionsDropdown = document.getElementById('suggestionsDropdown');
            
            // Show suggestions on focus (only if no search has been performed yet)
            textInput.addEventListener('focus', function() {
                if (!hasSearched) {
                    suggestionsDropdown.classList.add('show');
                }
            });
            
            // Hide suggestions when clicking outside
            document.addEventListener('click', function(event) {
                if (!textInput.contains(event.target) && !suggestionsDropdown.contains(event.target)) {
                    suggestionsDropdown.classList.remove('show');
                }
            });
            
            // Handle suggestion clicks
            document.querySelectorAll('.suggestion-chip').forEach(chip => {
                chip.addEventListener('click', function() {
                    const suggestion = this.textContent.trim();
                    textInput.value = suggestion;
                    suggestionsDropdown.classList.remove('show');
                    getEnhancedRecommendations(new Event('submit'));
                });
            });
            
            // Star rating
            document.querySelectorAll('.star').forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.dataset.rating);
                    currentRating = rating;
                    
                    document.querySelectorAll('.star').forEach((s, index) => {
                        if (index < rating) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                });
            });
        }

        // Function to detect social context from text input
        function detectSocialContext(text) {
            if (!text || text.trim() === '') {
                return 'alone';
            }
            
            const lowerText = text.toLowerCase();
            
            // Check for social context keywords with priority order
            // Partner/Romantic context (highest priority)
            if (lowerText.includes('with partner') || lowerText.includes('with my partner') ||
                lowerText.includes('romantic') || lowerText.includes('date night') ||
                lowerText.includes('date') || lowerText.includes('boyfriend') ||
                lowerText.includes('girlfriend') || lowerText.includes('spouse') ||
                lowerText.includes('husband') || lowerText.includes('wife') ||
                lowerText.includes('valentine') || lowerText.includes('anniversary')) {
                return 'with_partner';
            }
            
            // Family context
            if (lowerText.includes('with family') || lowerText.includes('family dinner') ||
                lowerText.includes('family meal') || lowerText.includes('family') ||
                lowerText.includes('mom') || lowerText.includes('dad') || 
                lowerText.includes('parents') || lowerText.includes('kids') ||
                lowerText.includes('children') || lowerText.includes('siblings') ||
                lowerText.includes('brother') || lowerText.includes('sister') ||
                lowerText.includes('grandma') || lowerText.includes('grandpa')) {
                return 'with_family';
            }
            
            // Work/Colleagues context
            if (lowerText.includes('with colleagues') || lowerText.includes('with coworkers') ||
                lowerText.includes('work lunch') || lowerText.includes('office') ||
                lowerText.includes('colleague') || lowerText.includes('coworker') ||
                lowerText.includes('team') || lowerText.includes('business') ||
                lowerText.includes('meeting') || lowerText.includes('work') ||
                lowerText.includes('professional') || lowerText.includes('client')) {
                return 'with_colleagues';
            }
            
            // Friends context (lower priority to avoid false positives)
            if ((lowerText.includes('with friend') || lowerText.includes('with friends')) ||
                (lowerText.includes('hanging out with') && (lowerText.includes('friend') || lowerText.includes('friends'))) ||
                (lowerText.includes('meeting friends') || lowerText.includes('friend group'))) {
                return 'with_friends';
            }
            
            // Default to alone if no social context detected
            return 'alone';
        }

        // Main recommendation function
        async function getEnhancedRecommendations(e) {
            e.preventDefault();
            
            hasSearched = true;
            document.getElementById('suggestionsDropdown').classList.remove('show');
            
            // Update placeholder text after first search
            const textInputElement = document.getElementById('textInput');
            if (textInputElement.placeholder === "What are you craving today?") {
                textInputElement.placeholder = "Refine your search or try something new...";
            }
            
            // Declare startTime outside try block so it's accessible in catch
            const startTime = Date.now();
            
            try {
                hideError();
                showLoader();
                clearResults();

                const textInput = textInputElement.value.trim();
                const timeOfDay = document.getElementById('timeDisplay').textContent.replace('Morning', 'morning').replace('Afternoon', 'afternoon').replace('Evening', 'evening').replace('Night', 'night');
                const weather = await getCurrentWeather();
                const socialContext = detectSocialContext(textInput);
                const energyLevel = window.selectedEnergyLevel || 'medium';

                if (!textInput) {
                    throw new Error('Please provide a text input');
                }

                const requestData = {
                    text_input: textInput,
                    image_base64: null,
                    audio_base64: null,
                    user_context: {
                        time_of_day: timeOfDay,
                        weather: weather,
                        social_context: socialContext,
                        energy_level: energyLevel
                    }
                };

                const debugToggle = document.querySelector('.debug-toggle');
                if (debugToggle && debugToggle.classList.contains('active')) {
                    document.getElementById('debugRequest').textContent = JSON.stringify(requestData, null, 2);
                    document.getElementById('debugApiBase').textContent = API_BASE;
                    
                    // Add social context detection info to debug
                    const debugInfo = {
                        original_text: textInput,
                        detected_social_context: socialContext,
                        detection_method: 'automatic_from_text'
                    };
                    const debugInfoElement = document.createElement('div');
                    debugInfoElement.classList.add('debug-item');
                    debugInfoElement.innerHTML = `
                        <h4>Social Context Detection</h4>
                        <pre>${JSON.stringify(debugInfo, null, 2)}</pre>
                    `;
                    document.querySelector('.debug-content').appendChild(debugInfoElement);
                }
                
                // Log query locally for dataset growth
                logQueryLocally(textInput, requestData, startTime);
                
                const response = await fetch(`${API_BASE}/enhanced-recommend`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                const endTime = Date.now();

                // Add comprehensive console logging for debugging
                console.log("Got backend response:", data);
                console.log("Response structure:", {
                    hasRecommendations: !!data.recommendations,
                    recommendationsCount: data.recommendations ? data.recommendations.length : 0,
                    recommendationsType: data.recommendations ? typeof data.recommendations : 'undefined',
                    firstRecommendation: data.recommendations && data.recommendations.length > 0 ? data.recommendations[0] : 'none'
                });

                // Log successful response locally
                logResponseLocally(data, endTime, startTime);

                if (debugToggle && debugToggle.classList.contains('active')) {
                    document.getElementById('debugResponse').textContent = JSON.stringify(data, null, 2);
                    document.getElementById('debugPerformance').textContent = `Response time: ${endTime - startTime}ms`;
                }

                currentRecommendations = data;
                console.log("About to call showResults with data:", data);
                showResults(data);
                console.log("showResults completed, calling showFeedbackSection");
                showFeedbackSection(data);
                console.log("All display functions completed");

            } catch (error) {
                // Log error locally
                logErrorLocally(error, startTime);
                showError(error);
            } finally {
                hideLoader();
            }
        }

        // UI helper functions
        function showLoader() {
            document.getElementById('loadingSection').style.display = 'block';
        }

        function hideLoader() {
            document.getElementById('loadingSection').style.display = 'none';
        }

        function showError(error) {
            const errorSection = document.getElementById('errorSection');
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = error.message || 'An unexpected error occurred';
            errorSection.style.display = 'block';
        }

        function hideError() {
            document.getElementById('errorSection').style.display = 'none';
        }

        function clearResults() {
            document.getElementById('aiAnalysis').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('recommendationsGrid').innerHTML = '';
            document.getElementById('feedbackSection').style.display = 'none';
        }

        function showResults(data) {
            try {
                console.log("showResults called with data:", data);
                console.log("Data structure:", {
                    hasRecommendations: !!data.recommendations,
                    recommendationsCount: data.recommendations ? data.recommendations.length : 0,
                    recommendationsType: data.recommendations ? typeof data.recommendations : 'undefined',
                    firstRecommendation: data.recommendations && data.recommendations.length > 0 ? data.recommendations[0] : 'none'
                });
                
                showAIAnalysis(data);
                
                const resultsSection = document.getElementById('resultsSection');
                const recommendationsGrid = document.getElementById('recommendationsGrid');
                
                console.log("Found HTML elements:", {
                    resultsSection: !!resultsSection,
                    recommendationsGrid: !!recommendationsGrid
                });
                
                if (!resultsSection || !recommendationsGrid) {
                    console.error("Required HTML elements not found!");
                    return;
                }
                
                if (!data.recommendations || data.recommendations.length === 0) {
                    console.log("No recommendations found in data");
                    recommendationsGrid.innerHTML = '<p>No recommendations found. Please try a different input.</p>';
                    resultsSection.style.display = 'block';
                    return;
                }

            console.log(`Processing ${data.recommendations.length} recommendations`);
            
            let html = '';
            data.recommendations.forEach((rec, index) => {
                console.log(`Processing recommendation ${index + 1}:`, rec);
                console.log(`Recommendation type:`, typeof rec);
                console.log(`Recommendation reasoning:`, rec.reasoning || data.reasoning);
                
                // Handle both string format (from hybrid filter) and object format (from recommendation engine)
                let foodName, foodCategory, foodRegion, foodCulture, foodTags, score, moodMatch, reasoning;
                
                if (typeof rec === 'string') {
                    // String format from hybrid filter
                    foodName = rec;
                    foodCategory = 'AI Generated';
                    foodRegion = 'Global';
                    foodCulture = 'Universal';
                    foodTags = [];
                    score = 1.0 - (index * 0.1);
                    moodMatch = 1.0;
                    // Handle reasoning as string or array
                    reasoning = data.reasoning || 'AI-generated recommendation based on your query';
                } else {
                    // Object format from recommendation engine
                    foodName = rec.food_name || rec.title || rec.name || 'Unknown';
                    foodCategory = rec.food_category || rec.category || 'N/A';
                    foodRegion = rec.food_region || rec.region || 'N/A';
                    foodCulture = rec.food_culture || rec.culture || 'N/A';
                    foodTags = rec.food_tags || [];
                    score = rec.score || 0.5;
                    moodMatch = rec.mood_match || 0.5;
                    // Handle reasoning as string or array
                    reasoning = rec.reasoning || 'No reasoning provided';
                }
                
                html += `
                    <div class="recommendation-card" data-recommendation-index="${index}">
                        <div class="recommendation-content">
                            <div class="recommendation-header">
                                <h3 class="recommendation-title">${escapeHtml(foodName)}</h3>
                                <span class="recommendation-score">${(score * 100).toFixed(0)}%</span>
                            </div>
                            
                            <div class="recommendation-details">
                                <div class="detail-item">
                                    <span class="detail-label">Category</span>
                                    <span class="detail-value">${escapeHtml(foodCategory)}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Region</span>
                                    <span class="detail-value">${escapeHtml(foodRegion)}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Culture</span>
                                    <span class="detail-value">${escapeHtml(foodCulture)}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Mood Match</span>
                                    <span class="detail-value">${(moodMatch * 100).toFixed(0)}%</span>
                                </div>
                            </div>
                            
                            ${foodTags && foodTags.length > 0 ? `
                                <div class="card-tags">
                                    ${foodTags.map(tag => `<span class="tag">${escapeHtml(tag)}</span>`).join('')}
                                </div>
                            ` : ''}
                            
                            ${reasoning ? `
                                <div class="reasoning-section">
                                    <h4 class="reasoning-title">ðŸ¤” Why this recommendation?</h4>
                                    ${Array.isArray(reasoning) ? `
                                        <ul class="reasoning-list">
                                            ${reasoning.map(reason => `<li class="reasoning-item">${escapeHtml(reason)}</li>`).join('')}
                                        </ul>
                                    ` : `
                                        <div class="reasoning-text">${escapeHtml(reasoning)}</div>
                                    `}
                                </div>
                            ` : ''}
                            
                            <div class="feedback-section">
                                <div class="feedback-buttons">
                                    <button class="feedback-btn thumbs-up" onclick="submitRecommendationFeedback(${index}, 'positive')" title="This recommendation is perfect!">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M14 9V5a3 3 0 0 0-6 0v4M7 9h10a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-6a2 2 0 0 1 2-2z"/>
                                        </svg>
                                        Perfect!
                                    </button>
                                    <button class="feedback-btn thumbs-down" onclick="submitRecommendationFeedback(${index}, 'negative')" title="This doesn't match my mood">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M10 15v4a3 3 0 0 0 6 0v-4M7 9h10a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2z"/>
                                        </svg>
                                        Not for me
                                    </button>
                                </div>
                                <div class="feedback-status" id="feedbackStatus${index}">Help us improve!</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            console.log("Generated HTML for recommendations");
            console.log("HTML content length:", html.length);
            console.log("HTML preview:", html.substring(0, 200) + "...");
            
            recommendationsGrid.innerHTML = html;
            resultsSection.style.display = 'block';
            
            // Store current recommendations for feedback system
            window.currentRecommendations = data;
            
            // Remove any debugging styles
            resultsSection.style.border = '';
            resultsSection.style.backgroundColor = '';
            console.log("Results section should now be visible");
            
            console.log("showResults completed successfully");
            
            } catch (error) {
                console.error("Error in showResults:", error);
                console.error("Error details:", {
                    message: error.message,
                    stack: error.stack,
                    data: data
                });
            }
        }

        function showAIAnalysis(data) {
            try {
                const analysisDiv = document.getElementById('aiAnalysis');
                const aiDetailsDiv = document.getElementById('aiDetails');
                
                // Clear previous analysis
                aiDetailsDiv.innerHTML = '';
                
                // Show detected social context
                const textInput = document.getElementById('textInput').value.trim();
                const detectedSocialContext = detectSocialContext(textInput);
                const socialContextElement = document.createElement('div');
                socialContextElement.classList.add('ai-detail');
                socialContextElement.innerHTML = `
                    <div class="ai-detail-label">Social Context</div>
                    <div class="ai-detail-value">${detectedSocialContext.replace(/_/g, ' ')}</div>
                `;
                aiDetailsDiv.appendChild(socialContextElement);
                
                if (data.intent_prediction && data.intent_prediction.primary_intent) {
                    const primaryIntentElement = document.createElement('div');
                    primaryIntentElement.classList.add('ai-detail');
                    primaryIntentElement.innerHTML = `
                        <div class="ai-detail-label">Primary Intent</div>
                        <div class="ai-detail-value">${data.intent_prediction.primary_intent.replace(/_/g, ' ')}</div>
                    `;
                    aiDetailsDiv.appendChild(primaryIntentElement);
                    
                    const confidenceElement = document.createElement('div');
                    confidenceElement.classList.add('ai-detail');
                    confidenceElement.innerHTML = `
                        <div class="ai-detail-label">Confidence</div>
                        <div class="ai-detail-value">${data.intent_prediction.confidence > 0 ? `${(data.intent_prediction.confidence * 100).toFixed(0)}%` : 'N/A'}</div>
                    `;
                    aiDetailsDiv.appendChild(confidenceElement);
                }
                
                if (data.processing_time) {
                    const processingTimeElement = document.createElement('div');
                    processingTimeElement.classList.add('ai-detail');
                    processingTimeElement.innerHTML = `
                        <div class="ai-detail-label">Processing Time</div>
                        <div class="ai-detail-value">${(data.processing_time * 1000).toFixed(0)}ms</div>
                    `;
                    aiDetailsDiv.appendChild(processingTimeElement);
                }
                
                analysisDiv.style.display = 'block';
            } catch (error) {
                console.error('Error showing AI analysis:', error);
            }
        }
        
        function showFeedbackSection(data) {
            if (data.recommendations && data.recommendations.length > 0) {
                document.getElementById('feedbackSection').style.display = 'block';
            }
        }

        // Generate a simple trace ID for feedback
        function generateTraceId() {
            return `feedback_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        }

        function submitRecommendationFeedback(recommendationIndex, feedbackType) {
            try {
                console.log(`Submitting feedback for recommendation ${recommendationIndex}: ${feedbackType}`);
                
                // Get the current recommendations data
                const currentRecommendations = window.currentRecommendations;
                if (!currentRecommendations || !currentRecommendations.recommendations) {
                    console.error('No current recommendations available for feedback');
                    return;
                }

                const recommendation = currentRecommendations.recommendations[recommendationIndex];
                if (!recommendation) {
                    console.error(`Recommendation ${recommendationIndex} not found`);
                    return;
                }

                // Get the card and buttons
                const card = document.querySelector(`[data-recommendation-index="${recommendationIndex}"]`);
                if (!card) {
                    console.error(`Card for recommendation ${recommendationIndex} not found`);
                    return;
                }

                const thumbsUpBtn = card.querySelector('.thumbs-up');
                const thumbsDownBtn = card.querySelector('.thumbs-down');
                const feedbackStatus = document.getElementById(`feedbackStatus${recommendationIndex}`);

                // Add loading state to the clicked button
                const clickedBtn = feedbackType === 'positive' ? thumbsUpBtn : thumbsDownBtn;
                clickedBtn.classList.add('loading');

                // Update the feedback status immediately
                if (feedbackStatus) {
                    if (feedbackType === 'positive') {
                        feedbackStatus.textContent = 'Submitting...';
                        feedbackStatus.style.color = '#059669';
                    } else {
                        feedbackStatus.textContent = 'Submitting...';
                        feedbackStatus.style.color = '#dc2626';
                    }
                }

                // Update button states
                if (card) {
                    if (feedbackType === 'positive') {
                        thumbsUpBtn.classList.add('active');
                        thumbsDownBtn.classList.remove('active');
                    } else {
                        thumbsDownBtn.classList.add('active');
                        thumbsUpBtn.classList.remove('active');
                    }
                }

                // Prepare feedback data for the backend (matching the expected API format)
                const feedbackData = {
                    trace_id: generateTraceId(),
                    model_version: currentRecommendations.model_version || '1.0.0',
                    query: document.getElementById('textInput').value,
                    recommendations: currentRecommendations.recommendations,
                    implicit_signal: feedbackType === 'positive' ? 'accept' : 'skip',
                    session_id: Date.now().toString(),
                    user_id: 'anonymous'
                };

                // Send feedback to backend (async, don't wait for response)
                fetch(`${API_BASE}/feedback/implicit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(feedbackData)
                }).then(response => {
                    if (response.ok) {
                        console.log('Feedback submitted successfully');
                        // Update status to success
                        if (feedbackStatus) {
                            if (feedbackType === 'positive') {
                                feedbackStatus.textContent = 'Thank you! ðŸ‘';
                                feedbackStatus.style.color = '#059669';
                            } else {
                                feedbackStatus.textContent = 'Thanks for feedback! ðŸ‘Ž';
                                feedbackStatus.style.color = '#dc2626';
                            }
                        }
                    } else {
                        console.warn('Failed to submit feedback to backend');
                        // Update status to error
                        if (feedbackStatus) {
                            feedbackStatus.textContent = 'Submission failed';
                            feedbackStatus.style.color = '#dc2626';
                        }
                    }
                }).catch(error => {
                    console.warn('Error submitting feedback:', error);
                    // Update status to error
                    if (feedbackStatus) {
                        feedbackStatus.textContent = 'Submission failed';
                        feedbackStatus.style.color = '#dc2626';
                    }
                }).finally(() => {
                    // Remove loading state
                    clickedBtn.classList.remove('loading');
                });

                // Log the feedback data for debugging
                console.log('Feedback data sent:', feedbackData);

                // Store feedback locally for immediate use
                if (!window.recommendationFeedback) {
                    window.recommendationFeedback = {};
                }
                window.recommendationFeedback[recommendationIndex] = {
                    type: feedbackType,
                    timestamp: Date.now(),
                    recommendation: recommendation
                };

                console.log('Feedback processed successfully:', feedbackData);

            } catch (error) {
                console.error('Error submitting recommendation feedback:', error);
            }
        }

        async function submitFeedback() {
            if (!currentRecommendations) return;

            try {
                const feedbackData = {
                    user_id: 'anonymous',
                    session_id: Date.now().toString(),
                    input_text: document.getElementById('textInput').value,
                    recommended_foods: currentRecommendations.recommendations.map(r => r.food_name),
                    selected_food: null,
                    rating: currentRating,
                    feedback_text: document.getElementById('feedbackText').value,
                    context: {
                        time_of_day: document.getElementById('timeDisplay').textContent.replace('Morning', 'morning').replace('Afternoon', 'afternoon').replace('Evening', 'evening').replace('Night', 'night'),
                        weather: await getCurrentWeather(),
                        social_context: detectSocialContext(document.getElementById('textInput').value),
                        energy_level: window.selectedEnergyLevel || 'medium'
                    },
                    model_version: currentRecommendations.model_version || '1.0.0'
                };

                const response = await fetch(`${API_BASE}/feedback`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(feedbackData)
                });

                if (response.ok) {
                    alert('Thank you for your feedback! It will help improve our recommendations.');
                    currentRating = 0;
                    document.querySelectorAll('.star').forEach(star => star.classList.remove('active'));
                    document.getElementById('feedbackText').value = '';
                } else {
                    throw new Error('Failed to submit feedback');
                }

            } catch (error) {
                alert('Failed to submit feedback: ' + error.message);
            }
        }

        function toggleDebug() {
            const toggle = document.querySelector('.debug-toggle');
            toggle.classList.toggle('active');
            document.getElementById('debugApiBase').textContent = API_BASE;
        }

        // Energy Level Dropdown Functions
        function toggleEnergyDropdown() {
            const dropdown = document.getElementById('energyDropdown');
            const trigger = dropdown.querySelector('.dropdown-trigger');
            const isOpen = dropdown.classList.contains('open');
            
            dropdown.classList.toggle('open');
            trigger.setAttribute('aria-expanded', !isOpen);
        }

        function selectEnergyLevel(value, displayText) {
            document.getElementById('energyValue').textContent = displayText;
            const dropdown = document.getElementById('energyDropdown');
            const trigger = dropdown.querySelector('.dropdown-trigger');
            
            dropdown.classList.remove('open');
            trigger.setAttribute('aria-expanded', 'false');
            
            // Store the selected value for use in recommendations
            window.selectedEnergyLevel = value;
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('energyDropdown');
            if (!dropdown.contains(event.target)) {
                dropdown.classList.remove('open');
                const trigger = dropdown.querySelector('.dropdown-trigger');
                trigger.setAttribute('aria-expanded', 'false');
            }
        });

        // Keyboard navigation for dropdown
        document.addEventListener('keydown', function(event) {
            const dropdown = document.getElementById('energyDropdown');
            const trigger = dropdown.querySelector('.dropdown-trigger');
            const isOpen = dropdown.classList.contains('open');
            
            if (event.key === 'Escape' && isOpen) {
                dropdown.classList.remove('open');
                trigger.setAttribute('aria-expanded', 'false');
            }
            
            if (event.key === 'Enter' && event.target.classList.contains('dropdown-trigger')) {
                event.preventDefault();
                toggleEnergyDropdown();
            }
        });

        function escapeHtml(text) {
            if (typeof text !== 'string') return text;
            return text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        // Initialize debug info
        document.getElementById('debugApiBase').textContent = API_BASE;
        
        // ========================================
        // COMPREHENSIVE QUERY LOGGING SYSTEM
        // ========================================
        
        // Local storage key for query logs
        const QUERY_LOG_KEY = 'moodfood_query_logs';
        const MAX_LOCAL_LOGS = 1000; // Keep last 1000 queries locally
        
        /**
         * Log query locally for dataset growth and analysis
         */
        function logQueryLocally(textInput, requestData, startTime) {
            try {
                const queryLog = {
                    id: generateQueryId(),
                    timestamp: new Date().toISOString(),
                    text_input: textInput,
                    user_context: requestData.user_context,
                    request_data: requestData,
                    start_time: startTime,
                    status: 'pending',
                    source: 'frontend'
                };
                
                // Get existing logs
                const existingLogs = getLocalQueryLogs();
                existingLogs.push(queryLog);
                
                // Keep only the last MAX_LOCAL_LOGS entries
                if (existingLogs.length > MAX_LOCAL_LOGS) {
                    existingLogs.splice(0, existingLogs.length - MAX_LOCAL_LOGS);
                }
                
                // Save back to localStorage
                localStorage.setItem(QUERY_LOG_KEY, JSON.stringify(existingLogs));
                
                // Store current query ID for response logging
                window.currentQueryId = queryLog.id;
                
                console.log(`ðŸ“ Logged query locally: ${queryLog.id}`);
                
            } catch (error) {
                console.error('Failed to log query locally:', error);
            }
        }
        
        /**
         * Log API response locally
         */
        function logResponseLocally(responseData, endTime, startTime) {
            try {
                if (!window.currentQueryId) return;
                
                const existingLogs = getLocalQueryLogs();
                const queryIndex = existingLogs.findIndex(log => log.id === window.currentQueryId);
                
                if (queryIndex !== -1) {
                    const processingTime = endTime - startTime;
                    
                    existingLogs[queryIndex] = {
                        ...existingLogs[queryIndex],
                        status: 'completed',
                        response_data: responseData,
                        end_time: endTime,
                        processing_time_ms: processingTime,
                        intent_results: {
                            primary_intent: responseData.intent_prediction?.primary_intent,
                            confidence: responseData.intent_prediction?.confidence,
                            all_intents: responseData.intent_prediction?.all_intents
                        },
                        recommendations: {
                            count: responseData.recommendations?.length || 0,
                            items: responseData.recommendations || []
                        },
                        system_performance: responseData.system_performance || {}
                    };
                    
                    // Save updated logs
                    localStorage.setItem(QUERY_LOG_KEY, JSON.stringify(existingLogs));
                    
                    console.log(`ðŸ“ Updated query log: ${window.currentQueryId}`);
                }
                
            } catch (error) {
                console.error('Failed to log response locally:', error);
            }
        }
        
        /**
         * Log error locally
         */
        function logErrorLocally(error, startTime) {
            try {
                if (!window.currentQueryId) return;
                
                const existingLogs = getLocalQueryLogs();
                const queryIndex = existingLogs.findIndex(log => log.id === window.currentQueryId);
                
                if (queryIndex !== -1) {
                    existingLogs[queryIndex] = {
                        ...existingLogs[queryIndex],
                        status: 'error',
                        error: {
                            message: error.message,
                            type: error.name,
                            stack: error.stack
                        },
                        end_time: Date.now(),
                        processing_time_ms: Date.now() - startTime
                    };
                    
                    // Save updated logs
                    localStorage.setItem(QUERY_LOG_KEY, JSON.stringify(existingLogs));
                    
                    console.log(`ðŸ“ Logged error for query: ${window.currentQueryId}`);
                }
                
            } catch (logError) {
                console.error('Failed to log error locally:', logError);
            }
        }
        
        /**
         * Get local query logs
         */
        function getLocalQueryLogs() {
            try {
                const logs = localStorage.getItem(QUERY_LOG_KEY);
                return logs ? JSON.parse(logs) : [];
            } catch (error) {
                console.error('Failed to get local query logs:', error);
                return [];
            }
        }
        
        /**
         * Generate unique query ID
         */
        function generateQueryId() {
            const timestamp = Date.now();
            const random = Math.random().toString(36).substr(2, 9);
            return `frontend_${timestamp}_${random}`;
        }
        
        /**
         * Export local logs for analysis
         */
        function exportLocalLogs() {
            try {
                const logs = getLocalQueryLogs();
                const dataStr = JSON.stringify(logs, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `moodfood_query_logs_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                console.log(`ðŸ“Š Exported ${logs.length} query logs`);
                
            } catch (error) {
                console.error('Failed to export local logs:', error);
            }
        }
        
        /**
         * Get logging statistics
         */
        function getLocalLogStats() {
            try {
                const logs = getLocalQueryLogs();
                const total = logs.length;
                const completed = logs.filter(log => log.status === 'completed').length;
                const errors = logs.filter(log => log.status === 'error').length;
                const pending = logs.filter(log => log.status === 'pending').length;
                
                return {
                    total_queries: total,
                    completed: completed,
                    errors: errors,
                    pending: pending,
                    success_rate: total > 0 ? (completed / total * 100).toFixed(1) : 0
                };
            } catch (error) {
                console.error('Failed to get local log stats:', error);
                return {};
            }
        }
        
        // Add logging buttons to the UI
        function addLoggingUI() {
            const header = document.querySelector('.header-content');
            if (header) {
                const loggingDiv = document.createElement('div');
                loggingDiv.className = 'nav';
                loggingDiv.innerHTML = `
                    <button onclick="exportLocalLogs()" class="nav-item" title="Export Query Logs">
                        ðŸ“Š Export Logs
                    </button>
                    <button onclick="showLogStats()" class="nav-item" title="View Log Statistics">
                        ðŸ“ˆ Log Stats
                    </button>
                `;
                header.appendChild(loggingDiv);
            }
        }
        
        /**
         * Show logging statistics
         */
        function showLogStats() {
            const stats = getLocalLogStats();
            const message = `
ðŸ“Š Query Logging Statistics

Total Queries: ${stats.total_queries}
Completed: ${stats.completed}
Errors: ${stats.errors}
Pending: ${stats.pending}
Success Rate: ${stats.success_rate}%

Logs are stored locally and can be exported for analysis.
            `;
            alert(message);
        }
        
        // Initialize logging UI when page loads
        document.addEventListener('DOMContentLoaded', function() {
            addLoggingUI();
        });
        
    </script>
</body>
</html> 